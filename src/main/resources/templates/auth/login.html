<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.6/css/bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/css/error.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/css/style.css}" type="text/css"/>
    <title>Login</title>
</head>
<body>
<div class="container">
    <div class="d-flex flex-fill justify-content-center align-items-center login-container">
        <div class="login-box">
            <form id="form-login" th:object="${user}" method="post" th:action="@{/auth/login}">
                <div class="divider d-flex align-items-center my-4">
                </div>

                <div class="d-flex flex-row justify-content-center">
                    <h2>SIPRO by SmartPro</h2>
                </div>

                <div class="divider d-flex align-items-center my-2">
                </div>

                <!-- Email input -->
                <div data-mdb-input-init class="form-outline">
                    <label class="form-label" for="username">Username</label>
                    <input type="text" id="username" class="form-control form-control-lg" th:field="*{username}"
                           placeholder="your.name"/>
                    <ul class="error-ul">
                        <li th:each="err : ${#fields.errors('username')}" th:text="${err}" class="error"/>
                    </ul>
                </div>

                <!-- Password input -->
                <div data-mdb-input-init class="form-outline">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" id="password" th:field="*{password}" class="form-control form-control-lg"
                           placeholder="your password"/>
                    <p id="errorPwd" class="error"></p>
                    <ul class="error-ul">
                        <li th:each="err : ${#fields.errors('password')}" th:text="${err}" class="error"/>
                    </ul>
                </div>

                <div class="divider d-flex align-items-center my-2">
                </div>

                <!-- Start Of Captcha -->
                <div class="row">
                    <div class="col-4">
                        <img th:src="*{'data:realCaptcha/jpg;base64,'+realCaptcha}">
                    </div>
                </div>
                <div>
                    <span class="fas fa-key">Enter Captcha</span>
                </div>
                <div class="form-field d-flex align-items-center">
                    <span class="fas fa-key"></span>
                    <input type="hidden" th:field="*{hiddenCaptcha}"/>
                    <input type="text" th:field="*{captcha}" class="form-control"/>
                </div>
                <div>
                    <ul class="error-ul">
                        <li th:each="err: ${#fields.errors('captcha')}" th:text="${err}" class="error"/>
                    </ul>
                    <p id="errorCaptcha" class="error"></p>
                    <ul class="error-ul">
                        <li th:if="${captchaMessage!=null}" th:text="${captchaMessage}" class="error"/>
                    </ul>

                </div>
                <!-- End Of Captcha -->

                <div class="d-grid gap-2 col-6 mx-auto text-center">
                    <button id="btn-login" type="button" data-mdb-button-init data-mdb-ripple-init
                            class="btn btn-primary"
                            style="padding-left: 2.5rem; padding-right: 2.5rem;">Login
                    </button>
                    <!-- <p class="small fw-bold mt-2 pt-1 mb-0">Don't have an account? <a th:href="@{/regis}" class="link-danger">Register</a></p> -->

                    <a href="#!" class="text-body">Lupa password?</a>
                </div>

            </form>
        </div>
    </div>
</div>

<div th:replace="~{common/footer :: footer}"></div>

<script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script>
    $(document).ready(function () {
        $('#btn-login').on('click', function (e) {
            e.preventDefault();
            var pwd = $('#password').val();// Paul@1234
            // var pwdEncrypt = btoa(pwd);// 0ija0sijer09u
            var regex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[@_#\-$])[\w].{8,15}$/;
            var isOk = true;

            if (!regex.test(pwd)) {
                isOk = false;
                document.getElementById("errorPwd").innerHTML = "Incorrect password!";
            }

            if (isOk) {
                var pwdEncrypt = btoa(pwd);
                $("#password").val(pwdEncrypt);
                $("#form-login").submit();
            }
        })
    })
</script>
</body>
</html>